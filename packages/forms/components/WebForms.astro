---
import { createFormToken } from '../dist/form-tools/csrf.js';
import { saveSession } from '../dist/session/index.js';
import { formsSettings } from '../dist/settings.js';

export interface Props extends astroHTML.JSX.FormHTMLAttributes {
    
}

let formRequestToken = formsSettings.session && await createFormToken(Astro, formsSettings.csrf);
let htmlSolt: string;

try {
    htmlSolt = await Astro.slots.render('default');
} finally {
    //@ts-ignore
    const deleteMethods = Astro.request.formData?.deleteFiles ?? [];
    deleteMethods.forEach((func: Function) => func());
    formsSettings.session && await saveSession(Astro);
}

---
<form method="post" {...Astro.props}>
    {formRequestToken && <input type="hidden" name={formRequestToken.filed} value={formRequestToken.token} />}
    <Fragment set:html={htmlSolt} />    
</form>